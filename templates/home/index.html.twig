{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block body %}

    {% form_theme searchForm 'bootstrap_4_layout.html.twig' %}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert-{{ label }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <ul>
        {% for error in searchForm.vars.errors %}
            <li>{{ error.message }}</li>
        {% endfor %}
    </ul>

    {{ form_start(searchForm) }}


    <div class="group">
        <div class="form-group">
            <div>
                <div class="row">
                    <div class="offset-1 col-lg-5 col-md-5 ">
                        <div>
                            {{ form_label(searchForm.site) }}
                            {{ form_widget(searchForm.site, { 'attr': {'class': 'form-group', 'style':''}}) }}
                        </div>
                        <div>
                            {{ form_label(searchForm.name) }}
                            {{ form_widget(searchForm.name, { 'attr': {'class': 'form-group ', 'style':''}}) }}
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-6">
                                {{ form_label(searchForm.date_start) }}
                                {{ form_widget(searchForm.date_start, { 'attr': {'class': 'form-group', 'style':''}}) }}
                            </div>
                            <div class="col-lg-6 col-md-6">
                                {{ form_label(searchForm.date_end_of_registration) }}
                                {{ form_widget(searchForm.date_end_of_registration, { 'attr': {'class': 'form-group', 'style':''}}) }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 mt-4">
                        <div>
                            {{ form_widget(searchForm.user,{ 'attr': {'class': 'form-group', 'style':''}}) }}
                            {{ form_label(searchForm.user) }}
                        </div>
                        <div>
                            {{ form_widget(searchForm.subscribed, { 'attr': {'class': 'form-group', 'style':''}}) }}
                            {{ form_label(searchForm.subscribed) }}
                        </div>
                        <div>
                            {{ form_widget(searchForm.notSubscribed, { 'attr': {'class': 'form-group', 'style':''}}) }}
                            {{ form_label(searchForm.notSubscribed) }}
                        </div>
                        <div class="mb-3">
                            {{ form_widget(searchForm.eventEnded, { 'attr': {'class': 'form-group', 'style':''}}) }}
                            {{ form_label(searchForm.eventEnded) }}
                        </div>
                        <br>
                        <div class="mt-5">
                            <button type="submit" class="has-search">Rechercher</button>
                        </div>
                    </div>


                </div>
                {{ form_end(searchForm) }}
            </div>
        </div>
    </div>
    <div class="container">
        {% if eventsFromSearch is defined %}
            <table class="table">
                <thead>
                <tr>
                    <th>Nom de la sortie</th>
                    <th>Date de la sortie</th>
                    <th>Clôture</th>
                    <th>inscrits/places</th>
                    <th>Etat</th>
                    <th>Inscrit</th>
                    <th>Organisateur</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>

                {% for e in eventsFromSearch %}
                    <tr>
                        <td>{{ e.name }}</td>
                        <td>{{ e.dateStart|date('d/m/Y h:i') }}</td>
                        <td>{{ e.dateEndOfRegistration|date('d/m/Y h:i') }}</td>
                        <td>{{ e.subscribersUsers.count }}/{{ e.maxNumberPlaces }}</td>
                        <td>{{ e.state.name }}</td>
                        <td>{% for sub in e.subscribersUsers %}
                                {% if sub.id == app.user.id %}X
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td>{{ e.user.firstname }} {{ e.user.name|first|capitalize }}.</td>
                        <td>
                            {% if e.user.id == app.user.id or e.state.name != "En création" %}
                                <a href={{ path('detail', {id: e.id}) }}>Afficher</a>
                            {% else %}
                                <a href="#">Modifier</a>
                            {% endif %}
                            {% if e.state.name == "Créée" or e.state.name == "Ouverte" %}
                                {% if app.user.id == e.user.id %}
                                    {% if e.state.name == "Ouverte" %}
                                        - <a href={{ path('cancelEvent', {id: e.id}) }}>Annuler</a>
                                    {% endif %}
                                    {% if e.state.name == "En création" %}
                                        - <a href="#">Publier</a>
                                    {% endif %}
                                {% else %}
                                    {% if e.subscribersUsers|length > 0 %}
                                        {% for sub in e.subscribersUsers %}
                                            {% if app.user.id == sub.id %}
                                                - <a href={{ path('unsubscribe', {id: e.id}) }}>Se désister</a>
                                            {% else %}
                                                - <a href={{ path('subscribe', {id: e.id}) }}>S'inscrire</a>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        - <a href={{ path('subscribe', {id: e.id}) }}>S'inscrire</a>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
        <button>Créer une sortie</button>
    </div>

{% endblock %}